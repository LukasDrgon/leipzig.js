!function(e,s){"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?module.exports=s():e.Leipzig=s()}(this,function(){"use strict";var e=function(s){if(!(this instanceof e))return new e(s);var s=s||{};this.selector=s.selector||"[data-gloss]",this.classOrig=s.classOrig||"gloss__orig",this.classFree=s.classFree||"gloss__free",this.classLine=s.classLine||"gloss__line--",this.classAligned=s.classAligned||"gloss__aligned",this.firstLineOrig="undefined"!=typeof s.firstLineOrig?s.firstLineOrig:!1,this.lastLineFree="undefined"!=typeof s.lastLineFree?s.lastLineFree:!0};return e.prototype.tokenize=function(e){var s=/({.*?})|([^\s]+)/g,t=e.match(s).map(function(e){var s=e[0],t=e[e.length-1];return"{"===s&&"}"===t&&(e=e.slice(1,e.length-1)),e});return t},e.prototype.align=function(e){var s=e.reduce(function(e,s){return e.length>s.length?e:s},[]);return s.map(function(s,t){return e.map(function(e){return"undefined"==typeof e[t]?"":e[t]})})},e.prototype.format=function(e,s){var t=this,i=document.createElement(s),n=[];return e.forEach(function(e){n.push('<div class="'+t.classAligned+'">'),e.forEach(function(e,s){e=e?e:"&nbsp;",n.push('<p class="'+t.classLine+s+'">'+e+"</p>")}),n.push("</div>")}),i.innerHTML=n.join(""),i},e.prototype.gloss=function(){for(var e=document.querySelectorAll(this.selector),s=0;s<e.length;s++){var t=e[s],i=t.children,n=[],r=null;if(this.firstLineOrig){var a=t.firstElementChild;a.classList.add(this.classOrig)}if(this.lastLineFree){var l=t.lastElementChild;l.classList.add(this.classFree)}for(var o=0;o<i.length;o++){var c=i[o],f=c.classList.contains(this.classOrig),u=c.classList.contains(this.classFree),h=!f&&!u;h&&(n.push(this.tokenize(c.innerHTML)),c.style.display="none",r||(r=c))}var g,d=this.align(n);g="UL"===t.tagName||"OL"===t.tagName?"li":"div";var p=this.format(d,g);t.insertBefore(p,r)}},e});