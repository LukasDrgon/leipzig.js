!function(s,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():s.Leipzig=e()}(this,function(){"use strict";var s=function(e,n){function t(s,e,n){return"undefined"==typeof s[e]?n:s[e]}if(!(this instanceof s))return new s(e,n);var n=n||{};"string"==typeof e||e instanceof NodeList||e instanceof Element?n.elements=e:"object"==typeof e&&(n=e),this.elements=n.elements||"[data-gloss]",this.spacing=t(n,"spacing",!0),this.firstLineOrig=t(n,"firstLineOrig",!1),this.lastLineFree=t(n,"lastLineFree",!0),n.hasOwnProperty("class")||(n["class"]={}),this["class"]={glossed:n["class"].glossed||"gloss--glossed",words:n["class"].words||"gloss__words",word:n["class"].word||"gloss__word",noSpace:n["class"].noSpace||"gloss__word--no-space",line:n["class"].line||"gloss__line--",original:n["class"].original||"gloss__line--original",freeTranslation:n["class"].freeTranslation||"gloss__line--free",skip:n["class"].skip||"gloss__line--skip",hidden:n["class"].hidden||"gloss__line--hidden"}};return s.prototype.tokenize=function(s){var e=/({.*?})|([^\s]+)/g,n=s.match(e).map(function(s){var e=s[0],n=s[s.length-1];return"{"===e&&"}"===n&&(s=s.slice(1,s.length-1)),s});return n},s.prototype.align=function(s){var e=s.reduce(function(s,e){return s.length>e.length?s:e},[]);return e.map(function(e,n){return s.map(function(s){return"undefined"==typeof s[n]?"":s[n]})})},s.prototype.format=function(s,e){var n=this,t=document.createElement(e),i=[];return s.forEach(function(s){var e=[n["class"].word];n.spacing||e.push(n["class"].noSpace),e=e.join(" "),i.push('<div class="'+e+'">'),s.forEach(function(s,e){s=s?s:"&nbsp;",i.push('<p class="'+n["class"].line+e+'">'+s+"</p>")}),i.push("</div>")}),t.innerHTML=i.join(""),t.classList.add(this["class"].words),t},s.prototype.gloss=function(){var s;if("string"==typeof this.elements)s=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)s=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Unknown selector");s=[this.elements]}for(var e=0;e<s.length;e++){var n=s[e],t=n.children,i=[],a=null;if(this.firstLineOrig){var l=n.firstElementChild;l.classList.add(this["class"].original)}if(this.lastLineFree){var o=n.lastElementChild;o.classList.add(this["class"].freeTranslation)}for(var r=0;r<t.length;r++){var c=t[r],f=c.classList.contains(this["class"].original),d=c.classList.contains(this["class"].freeTranslation),h=c.classList.contains(this["class"].skip),p=!f&&!d&&!h;p&&(i.push(this.tokenize(c.innerHTML)),c.classList.add(this["class"].hidden),a||(a=c))}var g,u=this.align(i);g="UL"===n.tagName||"OL"===n.tagName?"li":"div";var m=this.format(u,g);n.classList.add(this["class"].glossed),n.insertBefore(m,a)}},s});