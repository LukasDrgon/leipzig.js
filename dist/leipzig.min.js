!function(e,s){if("function"==typeof define&&define.amd)define("Leipzig",["exports","module"],s);else if("undefined"!=typeof exports&&"undefined"!=typeof module)s(exports,module);else{var n={exports:{}};s(n.exports,n),e.Leipzig=n.exports}}(this,function(e,s){"use strict";function n(e,s){e.classList?e.classList.add(s):e.className+=" "+s}function i(e,s){var n;if(e.classList)n=e.classList.contains(s);else{var s=new RegExp("(^| )"+s+"( |$)","gi");n=new RegExp(s).test(e.className)}return n}function t(e,s,n){return"undefined"==typeof e[s]?n:e[s]}function r(e){return e.every(function(e){return"string"==typeof e})}var o=function l(e,s){if(!(this instanceof l))return new l(e,s);var s=s||{};if("string"==typeof e||e instanceof NodeList||e instanceof Element?s.elements=e:"object"==typeof e&&(s=e),this.elements=s.elements||"[data-gloss]",this.spacing=t(s,"spacing",!0),this.firstLineOrig=t(s,"firstLineOrig",!1),this.lastLineFree=t(s,"lastLineFree",!0),void 0===s.tokenizers)this.tokenizers=["{(.*?)}","([^\\s]+)"];else if(s.tokenizers instanceof Array&&r(s.tokenizers))this.tokenizers=s.tokenizers;else{if("string"!=typeof s.tokenizers)throw new Error("Unknown format for tokenizers");this.tokenizers=[s.tokenizers]}s.hasOwnProperty("class")||(s["class"]={}),this["class"]={glossed:s["class"].glossed||"gloss--glossed",noSpace:s["class"].noSpace||"gloss--no-space",words:s["class"].words||"gloss__words",word:s["class"].word||"gloss__word",line:s["class"].line||"gloss__line--",original:s["class"].original||"gloss__line--original",freeTranslation:s["class"].freeTranslation||"gloss__line--free",noAlign:s["class"].noAlign||"gloss__line--no-align",hidden:s["class"].hidden||"gloss__line--hidden"}};o.prototype.tokenize=function(e){var s=this.tokenizers.join("|"),n=new RegExp(s,"g"),i=e.match(n).map(function(e){var s=e[0],n=e[e.length-1];if("{"===s&&"}"===n){var i=/(?:{)(.*)(?:})/;e=i.exec(e)[1]}return e});return i},o.prototype.align=function(e){var s=e.reduce(function(e,s){return e.length>s.length?e:s},[]);return s.map(function(s,n){return e.map(function(e){return"undefined"==typeof e[n]?"":e[n]})})},o.prototype.format=function(e,s){var i=this,t=[],s=document.createElement(s);return n(s,i["class"].words),e.forEach(function(e){var s=[i["class"].word];s=s.join(" "),t.push('<div class="'+s+'">'),e.forEach(function(e,s){e=e?e:"&nbsp;",t.push('<p class="'+i["class"].line+s+'">'+e+"</p>")}),t.push("</div>")}),s.innerHTML=t.join(""),s},o.prototype.gloss=function a(){var e;if("string"==typeof this.elements)e=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)e=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Invalid selector");e=[this.elements]}for(var s=0;s<e.length;s++){var t,a=e[s],r=a.children,o=[];if(this.firstLineOrig){var l=a.firstElementChild;n(l,this["class"].original)}if(this.lastLineFree){var c=a.lastElementChild;n(c,this["class"].freeTranslation)}for(var f=0;f<r.length;f++){var h=r[f],d=i(h,this["class"].original),g=i(h,this["class"].freeTranslation),p=i(h,this["class"].noAlign),u=!d&&!g&&!p;u&&(o.push(this.tokenize(h.innerHTML)),n(h,this["class"].hidden),t||(t=h))}var m,v=this.align(o);m="UL"===a.tagName||"OL"===a.tagName?"li":"div";var v=this.format(v,m);a.insertBefore(v,t),this.spacing||n(a,this["class"].noSpace),n(a,this["class"].glossed)}},s.exports=o});