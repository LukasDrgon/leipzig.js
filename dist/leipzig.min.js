!function(s,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():s.Leipzig=e()}(this,function(){"use strict";function s(s,e){s.classList?s.classList.add(e):s.className+=" "+e}function e(s,e){var n;if(s.classList)n=s.classList.contains(e);else{var e=new RegExp("(^| )"+e+"( |$)","gi");n=new RegExp(e).test(s.className)}return n}function n(s,e,n){return"undefined"==typeof s[e]?n:s[e]}var t=function(s,e){if(!(this instanceof t))return new t(s,e);var e=e||{};"string"==typeof s||s instanceof NodeList||s instanceof Element?e.elements=s:"object"==typeof s&&(e=s),this.elements=e.elements||"[data-gloss]",this.spacing=n(e,"spacing",!0),this.firstLineOrig=n(e,"firstLineOrig",!1),this.lastLineFree=n(e,"lastLineFree",!0),e.hasOwnProperty("class")||(e["class"]={}),this["class"]={glossed:e["class"].glossed||"gloss--glossed",words:e["class"].words||"gloss__words",word:e["class"].word||"gloss__word",noSpace:e["class"].noSpace||"gloss__word--no-space",line:e["class"].line||"gloss__line--",original:e["class"].original||"gloss__line--original",freeTranslation:e["class"].freeTranslation||"gloss__line--free",skip:e["class"].skip||"gloss__line--skip",hidden:e["class"].hidden||"gloss__line--hidden"}};return t.prototype.tokenize=function(s){var e=/({.*?})|([^\s]+)/g,n=s.match(e).map(function(s){var e=s[0],n=s[s.length-1];return"{"===e&&"}"===n&&(s=s.slice(1,s.length-1)),s});return n},t.prototype.align=function(s){var e=s.reduce(function(s,e){return s.length>e.length?s:e},[]);return e.map(function(e,n){return s.map(function(s){return"undefined"==typeof s[n]?"":s[n]})})},t.prototype.format=function(e,n){var t=this,i=[],n=document.createElement(n);return s(n,t["class"].words),e.forEach(function(s){var e=[t["class"].word];t.spacing||e.push(t["class"].noSpace),e=e.join(" "),i.push('<div class="'+e+'">'),s.forEach(function(s,e){s=s?s:"&nbsp;",i.push('<p class="'+t["class"].line+e+'">'+s+"</p>")}),i.push("</div>")}),n.innerHTML=i.join(""),n},t.prototype.gloss=function i(){var n;if("string"==typeof this.elements)n=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)n=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Unknown selector");n=[this.elements]}for(var t=0;t<n.length;t++){var r,i=n[t],l=i.children,a=[];if(this.firstLineOrig){var o=i.firstElementChild;s(o,this["class"].original)}if(this.lastLineFree){var c=i.lastElementChild;s(c,this["class"].freeTranslation)}for(var f=0;f<l.length;f++){var h=l[f],d=e(h,this["class"].original),g=e(h,this["class"].freeTranslation),p=e(h,this["class"].skip),u=!d&&!g&&!p;u&&(a.push(this.tokenize(h.innerHTML)),s(h,this["class"].hidden),r||(r=h))}var m,v=this.align(a);m="UL"===i.tagName||"OL"===i.tagName?"li":"div";var v=this.format(v,m);i.insertBefore(v,r),s(i,this["class"].glossed)}},t});