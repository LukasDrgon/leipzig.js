!function(s,e){if("function"==typeof define&&define.amd)define("Leipzig",["exports","module"],e);else if("undefined"!=typeof exports&&"undefined"!=typeof module)e(exports,module);else{var n={exports:{}};e(n.exports,n),s.Leipzig=n.exports}}(this,function(s,e){"use strict";function n(s,e){s.classList?s.classList.add(e):s.className+=" "+e}function t(s,e){var n;if(s.classList)n=s.classList.contains(e);else{var e=new RegExp("(^| )"+e+"( |$)","gi");n=new RegExp(e).test(s.className)}return n}function i(s,e,n){return"undefined"==typeof s[e]?n:s[e]}var o=function r(s,e){if(!(this instanceof r))return new r(s,e);var e=e||{};"string"==typeof s||s instanceof NodeList||s instanceof Element?e.elements=s:"object"==typeof s&&(e=s),this.elements=e.elements||"[data-gloss]",this.spacing=i(e,"spacing",!0),this.firstLineOrig=i(e,"firstLineOrig",!1),this.lastLineFree=i(e,"lastLineFree",!0),e.hasOwnProperty("class")||(e["class"]={}),this["class"]={glossed:e["class"].glossed||"gloss--glossed",words:e["class"].words||"gloss__words",word:e["class"].word||"gloss__word",noSpace:e["class"].noSpace||"gloss__word--no-space",line:e["class"].line||"gloss__line--",original:e["class"].original||"gloss__line--original",freeTranslation:e["class"].freeTranslation||"gloss__line--free",skip:e["class"].skip||"gloss__line--skip",hidden:e["class"].hidden||"gloss__line--hidden"}};o.prototype.tokenize=function(s){var e=/({.*?})|([^\s]+)/g,n=s.match(e).map(function(s){var e=s[0],n=s[s.length-1];return"{"===e&&"}"===n&&(s=s.slice(1,s.length-1)),s});return n},o.prototype.align=function(s){var e=s.reduce(function(s,e){return s.length>e.length?s:e},[]);return e.map(function(e,n){return s.map(function(s){return"undefined"==typeof s[n]?"":s[n]})})},o.prototype.format=function(s,e){var t=this,i=[],e=document.createElement(e);return n(e,t["class"].words),s.forEach(function(s){var e=[t["class"].word];t.spacing||e.push(t["class"].noSpace),e=e.join(" "),i.push('<div class="'+e+'">'),s.forEach(function(s,e){s=s?s:"&nbsp;",i.push('<p class="'+t["class"].line+e+'">'+s+"</p>")}),i.push("</div>")}),e.innerHTML=i.join(""),e},o.prototype.gloss=function l(){var s;if("string"==typeof this.elements)s=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)s=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Unknown selector");s=[this.elements]}for(var e=0;e<s.length;e++){var i,l=s[e],o=l.children,r=[];if(this.firstLineOrig){var a=l.firstElementChild;n(a,this["class"].original)}if(this.lastLineFree){var c=l.lastElementChild;n(c,this["class"].freeTranslation)}for(var f=0;f<o.length;f++){var d=o[f],p=t(d,this["class"].original),h=t(d,this["class"].freeTranslation),g=t(d,this["class"].skip),u=!p&&!h&&!g;u&&(r.push(this.tokenize(d.innerHTML)),n(d,this["class"].hidden),i||(i=d))}var m,v=this.align(r);m="UL"===l.tagName||"OL"===l.tagName?"li":"div";var v=this.format(v,m);l.insertBefore(v,i),n(l,this["class"].glossed)}},e.exports=o});