!function(e,s){if("function"==typeof define&&define.amd)define("Leipzig",["exports","module"],s);else if("undefined"!=typeof exports&&"undefined"!=typeof module)s(exports,module);else{var n={exports:{}};s(n.exports,n),e.Leipzig=n.exports}}(this,function(e,s){"use strict";function n(e,s){e.classList?e.classList.add(s):e.className+=" "+s}function i(e,s){var n;if(e.classList)n=e.classList.contains(s);else{var s=new RegExp("(^| )"+s+"( |$)","gi");n=new RegExp(s).test(e.className)}return n}function t(e,s,n){return"undefined"==typeof e[s]?n:e[s]}function r(e){return e.every(function(e){return"string"==typeof e})}var o=function l(e,s){if(!(this instanceof l))return new l(e,s);var s=s||{};if("string"==typeof e||e instanceof NodeList||e instanceof Element?s.elements=e:"object"==typeof e&&(s=e),this.elements=s.elements||"[data-gloss]",this.spacing=t(s,"spacing",!0),this.firstLineOrig=t(s,"firstLineOrig",!1),this.lastLineFree=t(s,"lastLineFree",!0),void 0===s.tokenizers)this.tokenizers=["{(.*?)}","([^\\s]+)"];else if(s.tokenizers instanceof Array&&r(s.tokenizers))this.tokenizers=s.tokenizers;else if(s.tokenizers instanceof RegExp)this.tokenizers=s.tokenizers;else{if("string"!=typeof s.tokenizers)throw new Error("Invalid tokenizer");this.tokenizers=[s.tokenizers]}s.hasOwnProperty("class")||(s["class"]={}),this["class"]={glossed:s["class"].glossed||"gloss--glossed",noSpace:s["class"].noSpace||"gloss--no-space",words:s["class"].words||"gloss__words",word:s["class"].word||"gloss__word",line:s["class"].line||"gloss__line",lineNum:s["class"].lineNum||"gloss__line--",original:s["class"].original||"gloss__line--original",freeTranslation:s["class"].freeTranslation||"gloss__line--free",noAlign:s["class"].noAlign||"gloss__line--no-align",hidden:s["class"].hidden||"gloss__line--hidden"}};o.prototype.tokenize=function(e){var s;if(this.tokenizers instanceof RegExp)s=this.tokenizers;else{if(!(this.tokenizers instanceof Array))throw new Error("Invalid tokenizer");var n=this.tokenizers.join("|");s=new RegExp(n,"g")}var i=e.match(s).map(function(e){var s=e[0],n=e[e.length-1];if("{"===s&&"}"===n){var i=/(?:{)(.*)(?:})/;e=i.exec(e)[1]}return e});return i},o.prototype.align=function(e){var s=e.reduce(function(e,s){return e.length>s.length?e:s},[]);return s.map(function(s,n){return e.map(function(e){return"undefined"==typeof e[n]?"":e[n]})})},o.prototype.format=function(e,s,i){var t=this,r=[],s=document.createElement(s);return n(s,t["class"].words),e.forEach(function(e){var s=[t["class"].word];s=s.join(" "),r.push('<div class="'+s+'">'),e.forEach(function(e,s){var n=i+s;e=e?e:"&nbsp;",r.push('<p class="'+t["class"].line+" "+t["class"].lineNum+n+'">'+e+"</p>")}),r.push("</div>")}),s.innerHTML=r.join(""),s},o.prototype.gloss=function a(){var e;if("string"==typeof this.elements)e=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)e=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Invalid selector");e=[this.elements]}for(var s=0;s<e.length;s++){var a=e[s],t=a.children,r=[],o=null,l=0;if(this.firstLineOrig){var c=a.firstElementChild;n(c,this["class"].original)}if(this.lastLineFree){var f=a.lastElementChild;n(f,this["class"].freeTranslation)}for(var h=0;h<t.length;h++){var d=t[h],g=i(d,this["class"].original),u=i(d,this["class"].freeTranslation),p=i(d,this["class"].noAlign),m=!g&&!u&&!p;m?(r.push(this.tokenize(d.innerHTML)),n(d,this["class"].hidden),o||(o=d,l=h)):(n(d,""+this["class"].line),n(d,""+this["class"].lineNum+h))}var v,z=this.align(r);v="UL"===a.tagName||"OL"===a.tagName?"li":"div";var k=this.format(z,v,l);a.insertBefore(k,o),this.spacing||n(a,this["class"].noSpace),n(a,this["class"].glossed)}},s.exports=o});