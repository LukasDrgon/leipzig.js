!function(e,s){if("function"==typeof define&&define.amd)define("Leipzig",["exports","module"],s);else if("undefined"!=typeof exports&&"undefined"!=typeof module)s(exports,module);else{var n={exports:{}};s(n.exports,n),e.Leipzig=n.exports}}(this,function(e,s){"use strict";function n(e,s){e.classList?e.classList.add(s):e.className+=" "+s}function t(e,s){var n;if(e.classList)n=e.classList.contains(s);else{var s=new RegExp("(^| )"+s+"( |$)","gi");n=new RegExp(s).test(e.className)}return n}function i(e,s,n){return"undefined"==typeof e[s]?n:e[s]}function r(e){return e.every(function(e){return"string"==typeof e})}var o=function l(e,s){if(!(this instanceof l))return new l(e,s);var s=s||{};if("string"==typeof e||e instanceof NodeList||e instanceof Element?s.elements=e:"object"==typeof e&&(s=e),this.elements=s.elements||"[data-gloss]",this.spacing=i(s,"spacing",!0),this.firstLineOrig=i(s,"firstLineOrig",!1),this.lastLineFree=i(s,"lastLineFree",!0),console.log(s.tokenizers instanceof String),void 0===s.tokenizers)this.tokenizers=["{(.*?)}","([^\\s]+)"];else if(s.tokenizers instanceof Array&&r(s.tokenizers))this.tokenizers=s.tokenizers;else{if("string"!=typeof s.tokenizers)throw new Error("Unknown format for tokenizers");this.tokenizers=[s.tokenizers]}s.hasOwnProperty("class")||(s["class"]={}),this["class"]={glossed:s["class"].glossed||"gloss--glossed",words:s["class"].words||"gloss__words",word:s["class"].word||"gloss__word",noSpace:s["class"].noSpace||"gloss__word--no-space",line:s["class"].line||"gloss__line--",original:s["class"].original||"gloss__line--original",freeTranslation:s["class"].freeTranslation||"gloss__line--free",skip:s["class"].skip||"gloss__line--skip",hidden:s["class"].hidden||"gloss__line--hidden"}};o.prototype.tokenize=function(e){var s=this.tokenizers.join("|"),n=new RegExp(s,"g"),t=e.match(n).map(function(e){var s=e[0],n=e[e.length-1];if("{"===s&&"}"===n){var t=/(?:{)(.*)(?:})/;e=t.exec(e)[1]}return e});return t},o.prototype.align=function(e){var s=e.reduce(function(e,s){return e.length>s.length?e:s},[]);return s.map(function(s,n){return e.map(function(e){return"undefined"==typeof e[n]?"":e[n]})})},o.prototype.format=function(e,s){var t=this,i=[],s=document.createElement(s);return n(s,t["class"].words),e.forEach(function(e){var s=[t["class"].word];t.spacing||s.push(t["class"].noSpace),s=s.join(" "),i.push('<div class="'+s+'">'),e.forEach(function(e,s){e=e?e:"&nbsp;",i.push('<p class="'+t["class"].line+s+'">'+e+"</p>")}),i.push("</div>")}),s.innerHTML=i.join(""),s},o.prototype.gloss=function a(){var e;if("string"==typeof this.elements)e=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)e=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Unknown selector");e=[this.elements]}for(var s=0;s<e.length;s++){var i,a=e[s],r=a.children,o=[];if(this.firstLineOrig){var l=a.firstElementChild;n(l,this["class"].original)}if(this.lastLineFree){var c=a.lastElementChild;n(c,this["class"].freeTranslation)}for(var f=0;f<r.length;f++){var h=r[f],p=t(h,this["class"].original),d=t(h,this["class"].freeTranslation),g=t(h,this["class"].skip),u=!p&&!d&&!g;u&&(o.push(this.tokenize(h.innerHTML)),n(h,this["class"].hidden),i||(i=h))}var m,v=this.align(o);m="UL"===a.tagName||"OL"===a.tagName?"li":"div";var v=this.format(v,m);a.insertBefore(v,i),n(a,this["class"].glossed)}},s.exports=o});