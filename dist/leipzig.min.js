!function(s,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():s.Leipzig=e()}(this,function(){"use strict";var s=function(e,n){function t(s,e,n){return"undefined"==typeof s[e]?n:s[e]}if(!(this instanceof s))return new s(e,n);var n=n||{};"string"==typeof e||e instanceof NodeList||e instanceof Element?n.elements=e:"object"==typeof e&&(n=e),this.elements=n.elements||"[data-gloss]",this.spacing=t(n,"spacing",!0),this.firstLineOrig=t(n,"firstLineOrig",!1),this.lastLineFree=t(n,"lastLineFree",!0),n.hasOwnProperty("class")||(n["class"]={}),this["class"]={glossed:n["class"].glossed||"gloss--glossed",words:n["class"].words||"gloss__words",word:n["class"].word||"gloss__word",noSpace:n["class"].noSpace||"gloss__word--no-space",line:n["class"].line||"gloss__line--",original:n["class"].original||"gloss__line--original",freeTranslation:n["class"].freeTranslation||"gloss__line--free",skip:n["class"].skip||"gloss__line--skip",hidden:n["class"].hidden||"gloss__line--hidden"}};return s.prototype.tokenize=function(s){var e=/({.*?})|([^\s]+)/g,n=s.match(e).map(function(s){var e=s[0],n=s[s.length-1];return"{"===e&&"}"===n&&(s=s.slice(1,s.length-1)),s});return n},s.prototype.align=function(s){var e=s.reduce(function(s,e){return s.length>e.length?s:e},[]);return e.map(function(e,n){return s.map(function(s){return"undefined"==typeof s[n]?"":s[n]})})},s.prototype.format=function(s,e){var n=this,t=document.createElement(e),i=[];return s.forEach(function(s){var e=[n["class"].word];n.spacing||e.push(n["class"].noSpace),e=e.join(" "),i.push('<div class="'+e+'">'),s.forEach(function(s,e){s=s?s:"&nbsp;",i.push('<p class="'+n["class"].line+e+'">'+s+"</p>")}),i.push("</div>")}),t.innerHTML=i.join(""),t.classList.add(n["class"].words),t},s.prototype.gloss=function e(){function s(s,e){s.classList?s.classList.add(e):s.className+=" "+e}function n(s,e){var n;if(s.classList)n=s.classList.contains(e);else{var e=new RegExp("(^| )"+e+"( |$)","gi");n=new RegExp(e).test(s.className)}return n}var t;if("string"==typeof this.elements)t=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)t=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Unknown selector");t=[this.elements]}for(var i=0;i<t.length;i++){var e=t[i],l=e.children,r=[],a=null;if(this.firstLineOrig){var o=e.firstElementChild;s(o,this["class"].original)}if(this.lastLineFree){var c=e.lastElementChild;s(c,this["class"].freeTranslation)}for(var f=0;f<l.length;f++){var h=l[f],d=n(h,this["class"].original),g=n(h,this["class"].freeTranslation),p=n(h,this["class"].skip),u=!d&&!g&&!p;u&&(r.push(this.tokenize(h.innerHTML)),s(h,this["class"].hidden),a||(a=h))}var m,v=this.align(r);m="UL"===e.tagName||"OL"===e.tagName?"li":"div";var L=this.format(v,m);s(e,this["class"].glossed),e.insertBefore(L,a)}},s});