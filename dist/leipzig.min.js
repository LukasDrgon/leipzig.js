!function(e,i){if("function"==typeof define&&define.amd)define("Leipzig",["exports","module"],i);else if("undefined"!=typeof exports&&"undefined"!=typeof module)i(exports,module);else{var s={exports:{}};i(s.exports,s),e.Leipzig=s.exports}}(this,function(e,i){"use strict";function s(e,i){e.classList?e.classList.add(i):e.className+=" "+i}function t(e,i){var s;if(e.classList)s=e.classList.contains(i);else{var i=new RegExp("(^| )"+i+"( |$)","gi");s=new RegExp(i).test(e.className)}return s}function n(e,i,s){return"undefined"==typeof e[i]?s:e[i]}function a(e){return e.every(function(e){return"string"==typeof e})}var r=function o(e,i){if(!(this instanceof o))return new o(e,i);var i=i||{};if("string"==typeof e||e instanceof NodeList||e instanceof Element?i.elements=e:"object"==typeof e&&(i=e),this.elements=i.elements||"[data-gloss]",this.spacing=n(i,"spacing",!0),this.firstLineOrig=n(i,"firstLineOrig",!1),this.lastLineFree=n(i,"lastLineFree",!0),this.autoTag=n(i,"autoTag",!0),void 0===i.tokenizers)this.tokenizers=["{(.*?)}","([^\\s]+)"];else if(i.tokenizers instanceof Array&&a(i.tokenizers))this.tokenizers=i.tokenizers;else if(i.tokenizers instanceof RegExp)this.tokenizers=i.tokenizers;else{if("string"!=typeof i.tokenizers)throw new Error("Invalid tokenizer");this.tokenizers=[i.tokenizers]}i.hasOwnProperty("class")||(i["class"]={}),this["class"]={glossed:i["class"].glossed||"gloss--glossed",noSpace:i["class"].noSpace||"gloss--no-space",words:i["class"].words||"gloss__words",word:i["class"].word||"gloss__word",line:i["class"].line||"gloss__line",lineNum:i["class"].lineNum||"gloss__line--",original:i["class"].original||"gloss__line--original",freeTranslation:i["class"].freeTranslation||"gloss__line--free",noAlign:i["class"].noAlign||"gloss__line--no-align",hidden:i["class"].hidden||"gloss__line--hidden",abbr:i["class"].abbr||"gloss__abbr"}};r.prototype.tokenize=function(e){var i;if(this.tokenizers instanceof RegExp)i=this.tokenizers;else{if(!(this.tokenizers instanceof Array))throw new Error("Invalid tokenizer");var s=this.tokenizers.join("|");i=new RegExp(s,"g")}var t=e.match(i).map(function(e){var i=e[0],s=e[e.length-1];if("{"===i&&"}"===s){var t=/(?:{)(.*)(?:})/;e=t.exec(e)[1]}return e});return t},r.prototype.tag=function(e){var i=this,s=i.abbreviations,t=["(\\b[0-4])(?=[A-Z]|\\b)","(N?[A-Z]+\\b)"].join("|"),n=new RegExp(t,"g"),a=e.replace(n,function(e){var t,n=e,a="N"===n[0]&&n.length>1,e=a?n.slice(1):n;if(s[n]){var r=s[n];t='<abbr class="'+i["class"].abbr+'" title="'+r+'">'+n+"</abbr>"}else if(a&&s[e]){var r=s[e];t='<abbr class="'+i["class"].abbr+'" title="non-'+r+'">'+n+"</abbr>"}else t='<abbr class="'+i["class"].abbr+'">'+n+"</abbr>";return t});return a},r.prototype.align=function(e){var i=e.reduce(function(e,i){return e.length>i.length?e:i},[]);return i.map(function(i,s){return e.map(function(e){return"undefined"==typeof e[s]?"":e[s]})})},r.prototype.format=function(e,i,t){var n=this,a=[],i=document.createElement(i);return s(i,n["class"].words),e.forEach(function(e){var i=[n["class"].word];i=i.join(" "),a.push('<div class="'+i+'">'),e.forEach(function(e,i){var s=t+i;e=e?e:"&nbsp;",i>0&&n.autoTag&&(e=n.tag(e)),a.push('<p class="'+n["class"].line+" "+n["class"].lineNum+s+'">'+e+"</p>")}),a.push("</div>")}),i.innerHTML=a.join(""),i},r.prototype.gloss=function l(){var e;if("string"==typeof this.elements)e=document.querySelectorAll(this.elements);else if(this.elements instanceof NodeList)e=this.elements;else{if(!(this.elements instanceof Element))throw new Error("Invalid selector");e=[this.elements]}for(var i=0;i<e.length;i++){var l=e[i],n=l.children,a=[],r=null,o=0;if(this.firstLineOrig){var c=l.firstElementChild;s(c,this["class"].original)}if(this.lastLineFree){var f=l.lastElementChild;s(f,this["class"].freeTranslation)}for(var u=0;u<n.length;u++){var v=n[u],p=t(v,this["class"].original),g=t(v,this["class"].freeTranslation),d=t(v,this["class"].noAlign),h=!p&&!g&&!d;h?(a.push(this.tokenize(v.innerHTML)),s(v,this["class"].hidden),r||(r=v,o=u)):(s(v,""+this["class"].line),s(v,""+this["class"].lineNum+u))}var m,b=this.align(a);m="UL"===l.tagName||"OL"===l.tagName?"li":"div";var L=this.format(b,m,o);l.insertBefore(L,r),this.spacing||s(l,this["class"].noSpace),s(l,this["class"].glossed)}},r.prototype.abbreviations={1:"first person",2:"second person",3:"third person",A:"agent-like argument of canonical transitive verb",ABL:"ablative",ABS:"absolutive",ACC:"accusative",ADJ:"adjective",ADV:"adverb(ial)",AGR:"agreement",ALL:"allative",ANTIP:"antipassive",APPL:"applicative",ART:"article",AUX:"auxiliary",BEN:"benefactive",CAUS:"causative",CLF:"classifier",COM:"comitative",COMP:"complementizer",COMPL:"completive",COND:"conditional",COP:"copula",CVB:"converb",DAT:"dative",DECL:"declarative",DEF:"definite",DEM:"demonstrative",DET:"determiner",DIST:"distal",DISTR:"distributive",DU:"dual",DUR:"durative",ERG:"ergative",EXCL:"exclusive",F:"feminine",FOC:"focus",FUT:"future",GEN:"genitive",IMP:"imperative",INCL:"inclusive",IND:"indicative",INDF:"indefinite",INF:"infinitive",INS:"instrumental",INTR:"intransitive",IPFV:"imperfective",IRR:"irrealis",LOC:"locative",M:"masculine",N:"neuter",NEG:"negation / negative",NMLZ:"nominalizer / nominalization",NOM:"nominative",OBJ:"object",OBL:"oblique",P:"patient-like argument of canonical transitive verb",PASS:"passive",PFV:"perfective",PL:"plural",POSS:"possessive",PRED:"predicative",PRF:"perfect",PRS:"present",PROG:"progressive",PROH:"prohibitive",PROX:"proximal / proximate",PST:"past",PTCP:"participle",PURP:"purposive",Q:"question particle / marker",QUOT:"quotative",RECP:"reciprocal",REFL:"reflexive",REL:"relative",RES:"resultative",S:"single argument of canonical intransitive verb",SBJ:"subject",SBJV:"subjunctive",SG:"singular",TOP:"topic",TR:"transitive",VOC:"vocative"},i.exports=r});